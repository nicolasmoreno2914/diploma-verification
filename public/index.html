<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Verificación de Diplomas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="data:image/png;base64,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UWdxZ5FnkWfRZ9Fn8WgRaBFoUWhRaJFo0WkRaRFpUWmRaZFp0WoRalFqkWrRaxFrUWuRa9FsEWxRbJFs0W0RbVFtkW3RbhFuUW6RbtFvEW9Rb5Fv0XARcFFwkXDRcRFxUXGRcdFyEXJRcpFy0XMRc1FzkXPRdBF0UXSRdNF1EXVRdZF10XYRdlF2kXbRdxF3UXeRd9F4EXhReJF40XkReVF5kXnRehF6UXqRetF7EXtRe5F70XwRfFF8kXzRfRF9UX2RfdF+EX5RfpF+0X8Rf1F/kX/RgBGAUYCRgNGBEYFRgZGB0YIRglGCkYLRgxGDUYORg9GEEYRRhJGE0YURhVGFkYXRhhGGUYaRhtGHEYdRh5GH0YgRiFGIkYjRiRGJUYmRidGKEYpRipGK0YsRi1GLkYvRjBGMUYyRjNGNEY1RjZGN0Y4RjlGOkY7RjxGPUY+Rj9GQEZBRkJGQ0ZERkVGRkZHRkhGSUZKRktGTEZNRk5GT0ZQRlFGUkZTRlRGVUZWRldGWEZZRlpGW0ZcRl1GXkZfRmBGYUZiRmNGZEZlRmZGZ0ZoRmlGakZrRmxGbUZuRm9GcEZxRnJGc0Z0RnVGdkZ3RnhGeUZ6RntGfEZ9Rn5Gf0aARoFGgkaDRoRGhUaGRodGiEaJRopGi0aMRo1GjkaPRpBGkUaSRpNGlEaVRpZGl0aYRplGmkabRpxGnUaeRp9GoEahRqJGo0akRqVGpkanRqhGqUaqRqtGrEatRq5Gr0awRrFGskazRrRGtUa2RrdGuEa5RrpGu0a8Rr1Gvka/RsBGwUbCRsNGxEbFRsZGx0bIRslGykbLRsxGzUbORs9G0EbRRtJG00bURtVG1kbXRthG2UbaRttG3EbdRt5G30bgRuFG4kbjRuRG5UbmRudG6EbpRupG60bsRu1G7kbvRvBG8UbyRvNG9Eb1RvZG90b4RvlG+kb7RvxG/Ub+Rv9HAEcBRwJHA0cERwVHBkcHRwhHCUcKRwtHDEcNRw5HD0cQRxFHEkcTRxRHFUcWRxdHGEcZRxpHG0ccRx1HHkcfRyBHIUciRyNHJEclRyZHJ0coRylHKkcrRyxHLUcuRy9HMEcxRzJHM0c0RzVHNkc3RzhHOUc6RztHPEc9Rz5HP0dAR0FHQkdDR0RHRUdGR0dHSEdJR0pHS0dMR01HTkdPR1BHUUdSR1NHVEdVR1ZHV0dYR1lHWkdbR1xHXUdeR19HYEdhR2JHY0dkR2VHZkdnR2hHaUdqR2tHbEdtR25Hb0dwR3FHckdzR3RHdUd2R3dHeEd5R3pHe0d8R31Hfkd/R4BHgUeCR4NHhEeFR4ZHh0eIR4lHikeLR4xHjUeOR49HkEeRR5JHk0eUR5VHlkeXR5hHmUeaR5tHnEedR55Hn0egR6FHokejR6RHpUemR6dHqEepR6pHq0esR61HrkevR7BHsUeyR7NHtEe1R7ZHt0e4R7lHuke7R7xHvUe+R79HwEfBR8JHw0fER8VHxkfHR8hHyUfKR8tHzEfNR85Hz0fQR9FH0kfTR9RH1UfWR9dH2EfZR9pH20fcR91H3kffR+BH4UfiR+NH5EflR+ZH50foR+lH6kfrR+xH7UfuR+9H8EfxR/JH80f0R/VH9kf3R/hH+Uf6R/tH/Ef9R/5H/0gASAFIAkgDSARIBUgGSAdICEgJSApIC0gMSA1IDkgPSBBIEUgSSBNIFEgVSBZIF0gYSBlIGkgbSBxIHUgeSB9IIEghSCJII0gkSCVIJkgnSChIKUgqSCtILEgtSC5IL0gwSDFIMkgzSDRINUg2SDdIOEg5SDpIO0g8SD1IPkg/SEBIQUhCSENIREhFSEZIR0hISElISkjLSMxIzUjOSM9I0EjRSNJI00jUSNVI1kjXSNhI2UjaSNtI3EjdSN5I30jgSOFI4kjjSORIAA=" alt="Inandina" height="40" class="me-3">
                <div>
                    <div class="brand-title">Sistema de Verificación de Diplomas</div>
                    <div class="brand-subtitle">Consulta Segura y Confiable</div>
                </div>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <!-- Search Card -->
                <div class="card shadow-lg">
                    <div class="card-header bg-gradient text-white text-center">
                        <h3 class="mb-0">
                            <i class="fas fa-search me-2"></i>
                            Verificar Diploma
                        </h3>
                        <p class="mb-0 mt-2">Ingrese su número de cédula para consultar su diploma</p>
                    </div>
                    <div class="card-body p-4">
                        <form id="verificationForm">
                            <div class="mb-3">
                                <label for="cedula" class="form-label">
                                    <i class="fas fa-id-card me-1"></i>
                                    Número de Cédula o Tarjeta de Identidad
                                </label>
                                <input 
                                    type="text" 
                                    class="form-control form-control-lg" 
                                    id="cedula" 
                                    placeholder="Ej: 12345678"
                                    required
                                    maxlength="15"
                                >
                                <div class="form-text">
                                    Ingrese solo números, sin puntos ni espacios
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg w-100" id="searchBtn">
                                <i class="fas fa-search me-2"></i>
                                Buscar Diploma
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="text-center mt-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Buscando...</span>
                    </div>
                    <p class="mt-2">Consultando base de datos...</p>
                </div>

                <!-- Results Card -->
                <div id="resultsCard" class="card shadow-lg mt-4" style="display: none;">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-check-circle me-2"></i>
                            Diploma Encontrado
                        </h4>
                    </div>
                    <div class="card-body">
                        <div id="diplomaInfo"></div>
                    </div>
                </div>

                <!-- Error Card -->
                <div id="errorCard" class="card shadow-lg mt-4" style="display: none;">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Error en la Búsqueda
                        </h4>
                    </div>
                    <div class="card-body">
                        <p id="errorMessage" class="mb-0"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-body text-center">
                        <h5 class="card-title">Estadísticas del Sistema</h5>
                        <div class="row" id="statsContainer">
                            <div class="col-md-4">
                                <div class="stat-item">
                                    <i class="fas fa-certificate fa-2x text-primary mb-2"></i>
                                    <h4 id="totalDiplomas">-</h4>
                                    <p class="text-muted">Diplomas Registrados</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-item">
                                    <i class="fas fa-users fa-2x text-success mb-2"></i>
                                    <h4 id="totalEstudiantes">-</h4>
                                    <p class="text-muted">Estudiantes</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-item">
                                    <i class="fas fa-university fa-2x text-info mb-2"></i>
                                    <h4 id="totalInstituciones">-</h4>
                                    <p class="text-muted">Instituciones</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">
                <i class="fas fa-shield-alt me-1"></i>
                Sistema de Verificación de Diplomas - Consulta Segura y Confiable
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sistema de Verificación de Diplomas - Solución Embebida Definitiva
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Script embebido cargado correctamente');
            
            // Cargar estadísticas fijas inmediatamente
            document.getElementById('totalDiplomas').textContent = '2,794';
            document.getElementById('totalEstudiantes').textContent = '2,794';
            document.getElementById('totalInstituciones').textContent = '1';
            console.log('Estadísticas cargadas correctamente');
            
            // Elementos del DOM
            const form = document.getElementById('verificationForm');
            const cedulaInput = document.getElementById('cedula');
            const loadingDiv = document.getElementById('loadingSpinner');
            const resultsDiv = document.getElementById('resultsCard');
            const errorDiv = document.getElementById('errorCard');
            const errorMessage = document.getElementById('errorMessage');
            
            // URLs de Google Sheets
            const gvizTecnicosUrl = 'https://docs.google.com/spreadsheets/d/1s4beQ2-EJOwkjKwy_6jvJOtABPjD1104QyxS7kympo0/gviz/tq?tqx=out:csv&gid=1426995834';
            const gvizBachilleresUrl = 'https://docs.google.com/spreadsheets/d/1s4beQ2-EJOwkjKwy_6jvJOtABPjD1104QyxS7kympo0/gviz/tq?tqx=out:csv&gid=0';
            
            // Event listener para el formulario
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const cedula = cedulaInput.value.trim();
                if (cedula) {
                    searchDiploma(cedula);
                }
            });
            
            // Función principal de búsqueda
            async function searchDiploma(cedula) {
                showLoading();
                hideResults();
                hideError();
                
                try {
                    console.log('Buscando cédula:', cedula);
                    
                    // Buscar en técnicos primero
                    const tecnicosResponse = await fetch(gvizTecnicosUrl);
                    const tecnicosText = await tecnicosResponse.text();
                    console.log('Datos técnicos obtenidos, tamaño:', tecnicosText.length);
                    
                    let result = searchDirectInCSV(tecnicosText, cedula, 'Técnico');
                    
                    if (!result) {
                        // Buscar en bachilleres si no se encuentra en técnicos
                        const bachilleresResponse = await fetch(gvizBachilleresUrl);
                        const bachilleresText = await bachilleresResponse.text();
                        console.log('Datos bachilleres obtenidos, tamaño:', bachilleresText.length);
                        
                        result = searchDirectInCSV(bachilleresText, cedula, 'Bachiller');
                    }
                    
                    hideLoading();
                    
                    if (result) {
                        console.log('Diploma encontrado:', result);
                        displayDiplomaInfo(result);
                    } else {
                        console.log('Diploma no encontrado para cédula:', cedula);
                        showError('No se encontró ningún diploma registrado para esta cédula');
                    }
                } catch (error) {
                    console.error('Error en la búsqueda:', error);
                    hideLoading();
                    showError('Error de conexión. Por favor intente de nuevo más tarde.');
                }
            }
            
            // Función para buscar directamente en CSV
            function searchDirectInCSV(csvText, targetId, tipo) {
                const lines = csvText.split('\n');
                const normalizedTarget = targetId.toString().replace(/[^0-9]/g, '');
                console.log('Buscando ID normalizado:', normalizedTarget, 'en', tipo);
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    if (line.includes(normalizedTarget)) {
                        console.log('Línea encontrada:', line);
                        const cells = parseCSVLine(line);
                        
                        // Buscar la columna que contiene el documento
                        let documentColumn = -1;
                        let nameColumn = -1;
                        let dateColumn = -1;
                        let diplomaColumn = -1;
                        
                        for (let j = 0; j < cells.length; j++) {
                            const cellValue = cells[j].replace(/[^0-9]/g, '');
                            if (cellValue === normalizedTarget) {
                                documentColumn = j;
                                console.log('Documento encontrado en columna:', j);
                                
                                if (tipo === 'Técnico') {
                                    // Para técnicos: usar posiciones fijas basadas en estructura real
                                    nameColumn = 1;  // NOMBRES Y APELLIDOS
                                    dateColumn = 3;  // FECHA DE GRADO  
                                    diplomaColumn = 5; // NÚMERO DE DIPLOMA
                                    certificateColumn = 6; // CERTIFICADO RECIBIDO
                                } else {
                                    // Para bachilleres: usar posiciones corregidas
                                    nameColumn = 1;  // NOMBRES Y APELLIDOS
                                    dateColumn = 3;  // FECHA DE GRADUACIÓN
                                    diplomaColumn = 4; // CÓDIGO DE VERIFICACIÓN
                                }
                                break;
                            }
                        }
                        
                        if (documentColumn !== -1) {
                            const nombres = nameColumn !== -1 ? cells[nameColumn] : 'Nombre no disponible';
                            const fechaGrado = dateColumn !== -1 ? cells[dateColumn] : '';
                            const numeroDiploma = diplomaColumn !== -1 ? cells[diplomaColumn] : 'N/A';
                            const certificado = (tipo === 'Técnico' && certificateColumn !== -1) ? cells[certificateColumn] : null;
                            
                            console.log('Datos extraídos:', { nombres, fechaGrado, numeroDiploma, certificado });
                            
                            return {
                                nombres: nombres,
                                fechaGraduacion: formatDate(fechaGrado),
                                codigoVerificacion: numeroDiploma,
                                certificadoRecibido: certificado,
                                tipo: tipo,
                                institucion: 'Inandina',
                                ciudad: 'Villavicencio'
                            };
                        }
                    }
                }
                
                return null;
            }
            
            // Función para encontrar columna con contenido específico
            function findColumnWithContent(cells, startColumn, keywords, maxDistance) {
                for (let distance = 1; distance <= maxDistance; distance++) {
                    // Buscar hacia la izquierda
                    const leftIndex = startColumn - distance;
                    if (leftIndex >= 0 && cells[leftIndex] && cells[leftIndex].trim()) {
                        const content = cells[leftIndex].toLowerCase();
                        if (keywords.some(keyword => content.includes(keyword)) || content.length > 5) {
                            return leftIndex;
                        }
                    }
                    
                    // Buscar hacia la derecha
                    const rightIndex = startColumn + distance;
                    if (rightIndex < cells.length && cells[rightIndex] && cells[rightIndex].trim()) {
                        const content = cells[rightIndex].toLowerCase();
                        if (keywords.some(keyword => content.includes(keyword)) || content.length > 5) {
                            return rightIndex;
                        }
                    }
                }
                return -1;
            }
            
            // Función para parsear una línea CSV
            function parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            }
            
            // Función para formatear fecha
            function formatDate(dateStr) {
                if (!dateStr || dateStr.trim() === '') return 'Fecha no disponible';
                
                try {
                    // Intentar parsear diferentes formatos de fecha
                    let date;
                    if (dateStr.includes('/')) {
                        const parts = dateStr.split('/');
                        if (parts.length === 3) {
                            date = new Date(parts[2], parts[1] - 1, parts[0]);
                        }
                    } else if (dateStr.includes('-')) {
                        date = new Date(dateStr);
                    } else {
                        return dateStr; // Devolver como está si no se puede parsear
                    }
                    
                    if (date && !isNaN(date.getTime())) {
                        return date.toLocaleDateString('es-ES', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                    }
                } catch (error) {
                    console.error('Error formateando fecha:', error);
                }
                
                return dateStr; // Devolver original si hay error
            }
            
            // Función para mostrar información del diploma
            function displayDiplomaInfo(diplomaInfo) {
                const diplomaDiv = document.getElementById('diplomaInfo');
                
                // Campo de certificado solo para técnicos
                const certificateField = diplomaInfo.tipo === 'Técnico' && diplomaInfo.certificadoRecibido ? 
                    `<p><strong><i class="fas fa-award me-2"></i>Certificado Recibido:</strong><br>${diplomaInfo.certificadoRecibido}</p>` : '';
                
                diplomaDiv.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong><i class="fas fa-user me-2"></i>Estudiante:</strong><br>${diplomaInfo.nombres}</p>
                            <p><strong><i class="fas fa-calendar me-2"></i>Fecha de Graduación:</strong><br>${diplomaInfo.fechaGraduacion}</p>
                            <p><strong><i class="fas fa-certificate me-2"></i>Código de Verificación:</strong><br>${diplomaInfo.codigoVerificacion}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong><i class="fas fa-graduation-cap me-2"></i>Tipo:</strong><br>${diplomaInfo.tipo}</p>
                            ${certificateField}
                            <p><strong><i class="fas fa-university me-2"></i>Institución:</strong><br>${diplomaInfo.institucion}</p>
                            <p><strong><i class="fas fa-map-marker-alt me-2"></i>Ciudad:</strong><br>Villavicencio</p>
                        </div>
                    </div>
                `;
                showResults();
            }
            
            // Funciones de utilidad para mostrar/ocultar elementos
            function showLoading() {
                loadingDiv.style.display = 'block';
            }
            
            function hideLoading() {
                loadingDiv.style.display = 'none';
            }
            
            function showResults() {
                resultsDiv.style.display = 'block';
            }
            
            function hideResults() {
                resultsDiv.style.display = 'none';
            }
            
            function showError(message) {
                errorMessage.textContent = message;
                errorDiv.style.display = 'block';
            }
            
            function hideError() {
                errorDiv.style.display = 'none';
            }
            
            // Verificar si hay cédula en URL al cargar
            const urlParams = new URLSearchParams(window.location.search);
            const cedulaParam = urlParams.get('cedula');
            if (cedulaParam) {
                cedulaInput.value = cedulaParam;
                searchDiploma(cedulaParam);
            }
        });
    </script>
</body>
</html>
